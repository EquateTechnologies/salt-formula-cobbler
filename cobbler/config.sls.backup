{% from "cobbler/map.jinja" import cobbler_map with context %}

{% if cobbler_map.settings != {} %}
cobbler-settings-config:
  augeas.change:
    - context: /files/etc/cobbler/settings
    - changes:
{% for name, value in cobbler_map.settings.items() %}
      - set {{ name }} {{ value }}
{% endfor %}
    - watch_in:
      - service: cobblerd
  require:
    - pkg: cobbler
{% endif %}

{% if cobbler_map.modules != {} %}
cobbler-modules-config:
  augeas.change:
    - context: /files/etc/cobbler/modules.conf
    - changes:
{% for module_name, module in cobbler_map.modules.items() %}
{% for name, value in module.items() %}
      - set {{ module_name }}/module {{ value }}
{% endfor %}
{% endfor %}
    - watch_in:
      - service: cobblerd
  require:
    - pkg: cobbler
{% endif %}

cobbler-dnsmasq-config:
  file.managed:
    - source: salt://cobbler/files/dnsmasq.template
    - name: /etc/cobbler/dnsmasq.template
    - template: jinja
  require:
    - pkg: cobbler

cobbler-tftpd-config:
  file.managed:
    - source: salt://cobbler/files/tftpd.template
    - name: /etc/cobbler/tftpd.template
    - template: jinja
  require:
    - pkg: cobbler
